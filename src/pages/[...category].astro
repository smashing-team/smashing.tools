---
import { getCollection } from 'astro:content';

import GridList from '@/components/GridList.astro';
import Header from '@/components/Header.astro';

import { CATEGORIES } from '../consts';
import AppLayout from '../layouts/AppLayout.astro';

export const prerender = false;

const { category } = Astro.params;

const activeCategory = CATEGORIES.find((cat) => cat.category === category);
if (!activeCategory) return Astro.redirect('/404');

let items = [
  ...(await getCollection('code')),
  ...(await getCollection('design')),
].sort((a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf());

if (activeCategory.category) {
  items = items.filter((item) => item.collection === category);
}

export type AllItems = typeof items;
---

<AppLayout activeCategory={activeCategory.slug}>
  <Header transition:persist />
  <GridList items={items} />
</AppLayout>
